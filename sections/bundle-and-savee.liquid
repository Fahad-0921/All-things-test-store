{% assign discount_percentage = settings.discount_percentage | default: 15 %}

<div class="bundle-save-section">
  
  <h3>BUNDLE AND SAVE {{ discount_percentage }}%</h3>
  
  <div class="bundle-products">
    {% for product_block in block %}
      {% assign product = product_block.settings.product %}
      {% if product %}
        {% assign product_price = product.price | divided_by: 100 %}
        {% assign discount_multiplier = 1.0 | minus: discount_percentage | divided_by: 100 %}
        {% assign product_discounted_price = product_price | times: discount_multiplier %}

        <div class="product">
          <img src="{{ product.featured_image | img_url: 'medium' }}" alt="{{ product.title }}">
          <p>{{ product.title }} 
            <span class="discounted-price">${{ product_discounted_price | money }}</span> 
            <span class="original-price">${{ product_price | money }}</span>
          </p>
        </div>
        
        {% if forloop.index < forloop.length %}
          <div class="plus">+</div>
        {% endif %}
        
      {% else %}
        <p>Select a product in the theme editor.</p>
      {% endif %}
    {% endfor %}
  </div>

  <div class="total-price">
    {% assign original_total = 0 %}
    {% assign discounted_total = 0 %}

    {% for product_block in block %}
      {% assign product = product_block.settings.product %}
      {% if product %}
        {% assign product_price = product.price | divided_by: 100 %}
        {% assign product_discounted_price = product_price | times: discount_multiplier %}
        
        {% assign original_total = original_total | plus: product_price %}
        {% assign discounted_total = discounted_total | plus: product_discounted_price %}
      {% endif %}
    {% endfor %}
    
    <p>Total Price: 
      <span class="discounted-total">${{ discounted_total | money }}</span> 
      <span class="original-total">${{ original_total | money }}</span>
    </p>
  </div>
  
  <button class="add-to-cart">Add to Cart</button>
  
</div>


<style>
  
.bundle-save-section {
  border: 1px solid #333;
  padding: 20px;
  border-radius: 8px;
  max-width: 400px;
  margin-top: 100px;
  margin-bottom: 100px;
}

.bundle-save-section h3 {
  font-weight: bold;
  text-align: center;
  margin-bottom: 20px;
}

.bundle-products {
  display: flex;
  align-items: center;
  justify-content: space-around;
  margin-bottom: 20px;
}

.product img {
  width: 80px;
  height: auto;
}

.discounted-price {
  color: red;
  font-weight: bold;
}

.original-price, .original-total {
  text-decoration: line-through;
  color: #999;
}

.total-price {
  text-align: center;
  font-size: 1.2em;
  font-weight: bold;
}

.add-to-cart {
  display: block;
  background-color: #1a3d2e;
  color: #fff;
  padding: 10px;
  width: 100%;
  text-align: center;
  border-radius: 4px;
  cursor: pointer;
}
  
</style>

<script>
  
document.querySelector('.add-to-cart').addEventListener('click', function() {
  fetch('/cart/add.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      items: [
        { id: {{ product_1_variant_id }}, quantity: 1 },
        { id: {{ product_2_variant_id }}, quantity: 1 }
      ]
    })
  }).then(() => location.reload());
});
  
</script>




{% schema %}
{
  "name": "Bundle & Save",
  "settings": [
    {
      "type": "product",
      "id": "product_1",
      "label": "First Product"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Second Product"
    },
       {
      "type": "range",
      "id": "desktop_padding_top",
      "label": "Desktop Padding Top",
      "default": 0,
      "unit": "px",
      "min": 0,
      "max": 100
    },
  ],
    "presets": [
    {
      "name": "Bundle & Save"
    }
  ]
}
{% endschema %}
