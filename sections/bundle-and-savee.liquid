{% assign discount_percentage = settings.discount_percentage | default: 15 %}

{% assign product_1_price = product_1.price | divided_by: 100 %}
{% assign product_2_price = product_2.price | divided_by: 100 %}

{% assign discount_multiplier = 1.0 | minus: discount_percentage | divided_by: 100 %}

{% assign product_1_discounted_price = product_1_price | times: discount_multiplier %}
{% assign product_2_discounted_price = product_2_price | times: discount_multiplier %}

{% assign original_total = product_1_price | plus: product_2_price %}
{% assign discounted_total = original_total | times: discount_multiplier %}

<div class="bundle-save-section">
  <h3>BUNDLE AND SAVE {{ discount_percentage }}%</h3>
  
  <div class="bundle-products">
    {% if product_1 and product_2 %}
      <div class="product">
        <img src="{{ product_1.featured_image | img_url: 'medium' }}" alt="{{ product_1.title }}">
        <p>{{ product_1.title }} 
          <span class="discounted-price">${{ product_1_discounted_price | money }}</span> 
          <span class="original-price">${{ product_1_price | money }}</span>
        </p>
      </div>
      <div class="plus">+</div>
      <div class="product">
        <img src="{{ product_2.featured_image | img_url: 'medium' }}" alt="{{ product_2.title }}">
        <p>{{ product_2.title }} 
          <span class="discounted-price">${{ product_2_discounted_price | money }}</span> 
          <span class="original-price">${{ product_2_price | money }}</span>
        </p>
      </div>
    {% endif %}
  </div>
  
  <div class="total-price">
    <p>Total Price: 
      <span class="discounted-total">${{ discounted_total | money }}</span> 
      <span class="original-total">${{ original_total | money }}</span>
    </p>
  </div>
  
  <button class="add-to-cart">Add to Cart</button>
</div>



<style>
.bundle-save-section {
  border: 1px solid #333;
  padding: 20px;
  border-radius: 8px;
  max-width: 400px;
}

.bundle-save-section h3 {
  font-weight: bold;
  text-align: center;
  margin-bottom: 20px;
}

.bundle-products {
  display: flex;
  align-items: center;
  justify-content: space-around;
  margin-bottom: 20px;
}

.product img {
  width: 80px;
  height: auto;
}

.discounted-price {
  color: red;
  font-weight: bold;
}

.original-price, .original-total {
  text-decoration: line-through;
  color: #999;
}

.total-price {
  text-align: center;
  font-size: 1.2em;
  font-weight: bold;
}

.add-to-cart {
  display: block;
  background-color: #1a3d2e;
  color: #fff;
  padding: 10px;
  width: 100%;
  text-align: center;
  border-radius: 4px;
  cursor: pointer;
}



  
</style>

<script>
  
document.querySelector('.add-to-cart').addEventListener('click', function() {
  fetch('/cart/add.js', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      items: [
        { id: {{ product_1_variant_id }}, quantity: 1 },
        { id: {{ product_2_variant_id }}, quantity: 1 }
      ]
    })
  }).then(() => location.reload());
});


  
</script>


{% schema %}
{
  "name": "Bundle & Save",
  "settings": [
    {
      "type": "product",
      "id": "product_1",
      "label": "Select First Product"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Select Second Product"
    },
    {
      "type": "number",
      "id": "discount_percentage",
      "label": "Discount Percentage",
      "default": 15
    }
  ],
  "presets": [
    {
      "name": "Bundle & Save"
    }
  ]
}
{% endschema %}
